{% extends "base.html" %}
{% block meta %}
<title>Daftar Adopter</title>
{% endblock meta %}

{% block content %}
<div style="background-color: #f2eab8; min-height: 100vh;" class="py-5">
    <div class="container">
        <h1 class="text-center mb-5">Manajemen Data Adopter</h1>
        
        <div class="card shadow mb-5">
            <div class="card-header py-3 bg-success text-white">
                <h4 class="m-0 font-weight-bold">Adopter dengan Total Kontribusi Tertinggi dalam Setahun Terakhir</h4>
            </div>
            <div class="card-body">
                <ol class="list-group list-group-numbered">
                    {% for adopter in top_adopters %}
                    <li class="list-group-item d-flex justify-content-between align-items-start">
                        <div class="ms-2 me-auto">
                            <div class="fw-bold">{{ adopter.nama }}</div>
                        </div>
                        <span class="badge bg-primary rounded-pill">Rp{{ adopter.total_kontribusi|floatformat:0 }}</span>
                    </li>
                    {% empty %}
                    <li class="list-group-item">Belum ada data adopter</li>
                    {% endfor %}
                </ol>
            </div>
        </div>
        
        <div class="card shadow">
            <div class="card-header py-3 bg-primary text-white">
                <h4 class="m-0 font-weight-bold">Daftar Adopter</h4>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-bordered table-hover">
                        <thead class="table-light">
                            <tr>
                                <th>Nama Adopter</th>
                                <th>Total Kontribusi</th>
                                <th colspan="2" class="text-center">Aksi</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for adopter in adopters %}
                            <tr>
                                <td>{{ adopter.nama }}</td>
                                <td>Rp{{ adopter.total_kontribusi|floatformat:0 }}</td>
                                <td class="text-center">
                                    <a href="{% url 'adopsi:riwayat_adopsi' adopter.id %}" class="btn btn-sm btn-info">Lihat Detail</a>
                                </td>
                                <td class="text-center">
                                    <button type="button" class="btn btn-sm btn-danger" data-bs-toggle="modal" data-bs-target="#modalKonfirmasiHapusAdopter{{ adopter.id }}">
                                        Hapus
                                    </button>
                                </td>
                            </tr>
                            
                            <!-- Modal Konfirmasi Hapus Adopter -->
                            <div class="modal fade" id="modalKonfirmasiHapusAdopter{{ adopter.id }}" tabindex="-1" aria-hidden="true">
                                <div class="modal-dialog modal-dialog-centered">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h5 class="modal-title">Konfirmasi Hapus Adopter</h5>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Tutup"></button>
                                        </div>
                                        <div class="modal-body">
                                            <p>Apakah Anda yakin ingin menghapus adopter <strong>{{ adopter.nama }}</strong>?</p>
                                            <p class="text-danger">Tindakan ini akan menghapus seluruh data adopsi yang terkait dengan adopter ini.</p>
                                        </div>
                                        <div class="modal-footer">
                                            <form method="post" action="{% url 'adopsi:hapus_adopter' adopter.id %}">
                                                {% csrf_token %}
                                                <button type="submit" class="btn btn-danger">Hapus</button>
                                            </form>
                                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% empty %}
                            <tr>
                                <td colspan="4" class="text-center">Belum ada data adopter</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock content %}